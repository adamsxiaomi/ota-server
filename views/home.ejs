<!DOCTYPE html>
<!-- release v5.0.8, copyright 2014 - 2019 Kartik Visweswaran -->
<!--suppress JSUnresolvedLibraryURL -->
<html lang="zh-CH">

<!-- bootstrap -->
<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
    integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n"
    crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
    integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.15.0/umd/popper.min.js"
    integrity="sha384-L2pyEeut/H3mtgCBaUNw7KWzp5n9+4pDQiExs933/5QfaTh8YStYFFkOzSoXjlTb"
    crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
    integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
    crossorigin="anonymous"></script>
<!-- bootstrap -->


<!-- bootstrap-fileinput -->

<link href="/css/fileinput.css" media="all" rel="stylesheet" type="text/css" />
<link href="/themes/explorer-fas/theme.css" media="all" rel="stylesheet" type="text/css" />
<script src="https://code.jquery.com/jquery-3.3.1.min.js" crossorigin="anonymous"></script>
<script src="/js/plugins/piexif.js" type="text/javascript"></script>
<script src="/js/plugins/sortable.js" type="text/javascript"></script>
<script src="/js/fileinput.js" type="text/javascript"></script>
<script src="/js/locales/fr.js" type="text/javascript"></script>
<script src="/js/locales/zh.js" type="text/javascript"></script>
<script src="/themes/fas/theme.js" type="text/javascript"></script>
<script src="/themes/explorer-fas/theme.js" type="text/javascript"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.bundle.min.js"
    crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
    crossorigin="anonymous">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" crossorigin="anonymous">
<!-- bootstrap-fileinput -->


<head>
    <meta charset="UTF-8" />
    <title>for zz - &copy; adams</title>




</head>

<style>
    body {
        background-color: #F7FFFA;
    }

    .btn-style {
        position: absolute;
        right: 200px;
        top: 90px;
    }

    .btn2-style {
        position: absolute;
        right: 300px;
        top: 90px;
    }

    .form-style {
        position: absolute;
        top: 140px;
    }
</style>

<body>
    <!--Body content-->
    <!-- 导航 start -->
    <nav class="navbar navbar-expand-lg navbar-expand-sm navbar-dark bg-dark ">
        <div class="container-fluid  navbar-fixed-top">
            <a class="navbar-brand" href="#">Device</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
                aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav mr-auto">
                    <li class="nav-item active">
                        <a class="nav-link" href="#">主页 <span class="sr-only">(current)</span></a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/firewareManage">固件管理</a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button"
                            data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            日志分析
                        </a>
                        <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                            <a class="dropdown-item" href="#">Action</a>
                            <a class="dropdown-item" href="#">Another action</a>
                            <div class="dropdown-divider"></div>
                            <a class="dropdown-item" href="#">Something else here</a>
                        </div>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link disabled" href="#" tabindex="-1" aria-disabled="true">Disabled</a>
                    </li>
                </ul>
                <form class="form-inline my-2 my-lg-0">
                    <input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search">
                    <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
                </form>
            </div>
        </div>
    </nav>
    <!-- 导航 end -->

    <!-- <div class="form-group"> -->


    <!-- </div> -->
    </div>
    <!-- 表格 end -->
    <form>
        <div class="container-fluid ">
            <!-- 表单 -->
            <form class="form-horizontal" action="/update" method="post" role="form">
                <table class="table table-bordered text-dark form-style " id="devlist">
                    <thead>
                        <tr>
                            <th style='text-align: center;' scope="col"></th>
                            <th style='text-align: center;' scope="col">设备类型</th>
                            <th style='text-align: center;' scope="col">设备地址</th>
                            <th style='text-align: center;' scope="col">设备状态</th>
                            <th style='text-align: center;' scope="col">升级状态</th>
                            <th style='text-align: center;' scope="col">固件版本</th>
                            <th style='text-align: center;' scope="col">操作</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <th style='text-align: center;' scope="row">1</th>
                            <td style='text-align: center;'> 边缘路由</td>
                            <td style='text-align: center;'> 0100124B0013A4BE48</td>
                            <td style='text-align: center;'> online </td>
                            <td style='text-align: center;'> 正常</td>
                            <td style='text-align: center;' id="state"></td>
                            <td style='text-align: center;'> <input type="checkbox" class="checkbox-inline" id="1"
                                    name='updateCB' value='0100124B0013A4BE48'></td>
                        </tr>
                        <tr>
                            <th style='text-align: center;' scope="row">2</th>
                            <td style='text-align: center;'> 子路由</td>
                            <td style='text-align: center;'> 0100124B001975FA33</td>
                            <td style='text-align: center;'> offline</td>
                            <td style='text-align: center;'> 正常</td>
                            <td style='text-align: center;' id="state"></td>
                            <td style='text-align: center;'> <input type="checkbox" class="checkbox-inline" id="2"
                                    name='updateCB' value='0100124B001975FA33'> </td>
                        </tr>
                        <tr>
                            <th style='text-align: center;' scope="row">3</th>
                            <td style='text-align: center;'> 子路由</td>
                            <td style='text-align: center;'> 0100124B0019760590</td>
                            <td style='text-align: center;'> offline</td>
                            <td style='text-align: center;'> 正常</td>

                            <td style='text-align: center;' id="state"></td>
                            <td style='text-align: center;'> <input type="checkbox" class="checkbox-inline" id="3"
                                    name='updateCB' value='0100124B0019760590'></td>
                        </tr>
                        <tr>
                            <th style='text-align: center;' scope="row">4</th>
                            <td style='text-align: center;'> 子路由</td>
                            <td style='text-align: center;'> 0100124B00197605E7</td>
                            <td style='text-align: center;'> offline</td>
                            <td style='text-align: center;'> 正常</td>
                            <td style='text-align: center;' id="state"></td>
                            <td style='text-align: center;'> <input type="checkbox" class="checkbox-inline" id="4"
                                    name='updateCB' value='0100124B00197605E7'></td>
                        </tr>
                        <tr>
                            <th style='text-align: center;' scope="row">5</th>
                            <td style='text-align: center;'> 子路由</td>
                            <td style='text-align: center;'> 0100124B0017B0FBBC</td>
                            <td style='text-align: center;'> offline</td>
                            <td style='text-align: center;'> 正常</td>
                            <td style='text-align: center;' id="state"></td>
                            <td style='text-align: center;'> <input type="checkbox" class="checkbox-inline" id="5"
                                    name='updateCB' value='0100124B0017B0FBBC'></td>
                        </tr>
                        <tr>
                            <th style='text-align: center;' scope="row">6</th>
                            <td style='text-align: center;'> 子路由</td>
                            <td style='text-align: center;'> 0100124B0019760930</td>
                            <td style='text-align: center;'> offline</td>
                            <td style='text-align: center;'> 正常</td>
                            <td style='text-align: center;' id="state"></td>
                            <td style='text-align: center;'> <input type="checkbox" class="checkbox-inline" id="6"
                                    name='updateCB' value='0100124B0019760930'></td>
                        </tr>
                    </tbody>
                </table>
        </div>

        <!-- <input type="submit" value="提交" /> -->
        <button type="submit" id="btn_update" name="btn_update" class="btn btn-success btn-sm btn-style"> 升级 </button>
        <script>
            var ckvalue = "adsfdsfs";
            $(function () {
                $("#btn_update").click(function () {
                    var atr = [];
                    var checkBox = $('input[name="updateCB"]:checked');
                    for (var i = 0; i < checkBox.length; i++) {
                        atr[i] = checkBox[i].value;
                    }
                    console.log(checkBox);
                    if (checkBox.length > 1) {
                        alert("别选那么多设备");
                        return;
                    } else if (checkBox.length <= 0) {
                        alert("请选择要升级设备！");
                        return;
                    }
                    console.log(checkBox[0].id);
                    if (confirm("确认要升级" + atr[0] + "吗")) {
                        document.getElementById("devlist");
                        if(devlist.rows[checkBox[0].id].cells[4].innerHTML == "正在升级")
                        {
                            alert("设备"+ atr[0] + "已经在升级了");
                            return;
                        }
                        else{
                            var oState = document.getElementById('state');
                            oState.value = '正在升级';
                            devlist.rows[checkBox[0].id].cells[4].innerHTML = oState.value;
                        }
                    } else {
                        return;
                    }

                    $.ajax({
                        //要用post方式
                        type: "Post",
                        //方法所在页面和方法名
                        url: "/update",
                        data: {
                            user: 'tes',
                            pass: atr[0]
                        },
                        success: function (data) {
                            //返回的数据用data.d获取内容
                            // alert("操作成功");
                            alert(data);
                        },
                        error: function (err) {
                            alert("操作失败");
                        }
                    });
                    //禁用按钮的提交
                    return false;
                });
            });
        </script>

    </form>
    <!-- 表格 end -->
    <!--    <template id="firewareManage">-->
    <!-- 固件上传 start -->
    <div class="row-fluid">
        <div class="span2">
        </div>
        <div class="span6">
            <!-- 按钮触发   -->
            <button class="btn btn-success btn-sm btn2-style" data-toggle="modal" data-target="#myModal">固件上传</button>
        </div>
        <!-- 模态框（Modal） -->
        <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
            aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <!-- 表单 -->
                        <form class="form-horizontal" role="form">
                            <div class="form-group">
                                <label for="version" class="col-sm-5 control-label">版本号</label>
                                <div class="col-sm-10">
                                    <input type="text" class="form-control" id="version" placeholder="版本号">
                                </div>
                                <label for="devType" class="col-sm-5 control-label">设备类型</label>
                                <div class="col-sm-10">
                                    <input type="text" class="form-control" id="devType" placeholder="设备类型">
                                </div>
                            </div>

                            <div dir=rtl class="file-loading">
                                <!-- note the direction if you want to display file-loading indicator -->
                                <!-- note that your input must just set the `rtl` data property of the plugin or in your javascript code -->
                                <input id="firewareupload" name="firewareupload" type="file" multiple>
                            </div>
                            <script>
                                $(document).ready(function () {
                                    $("#firewareupload").fileinput({
                                        language: 'zh',
                                        rtl: true,
                                        dropZoneEnabled: true,
                                        allowedFileExtensions: ['bin', 'jpg'],
                                        uploadUrl: '/upload',
                                        typ: 'POST',
                                        enctype: 'multipart/form-data',
                                        theme: 'fa',
                                        showUpload: true,
                                        showPreview: true,
                                        maxFilePreviewSize: 1024,

                                    });
                                });
                            </script>
                        </form>
                    </div>
                </div>
                <!-- /.modal-content -->
            </div>
            <!-- /.modal -->
        </div>
    </div>
    <div class="span4">
    </div>
    </div>
    </div>
    </div>
    <!-- 固件上传 end -->
    <!--    </template>-->


</body>

</html>